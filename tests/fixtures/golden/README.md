# Golden Test Fixtures

This directory contains PMTiles files generated by tippecanoe for golden comparison testing.

## Generation

Golden tiles were generated using tippecanoe v2.49.0 with the following command pattern:

```bash
tippecanoe \
    -P \
    '--layer=<layer-name>' \
    '--maximum-zoom=10' \
    --simplify-only-low-zooms \
    --no-simplification-of-shared-nodes \
    --no-tile-size-limit \
    --no-feature-limit \
    --force \
    '--output=<output>.pmtiles' \
    '<input>.geojsonl'
```

### Key flags explained:

- `-P` / `--read-parallel`: Read input files in parallel
- `--simplify-only-low-zooms`: Only simplify at lower zoom levels (preserves detail at max zoom)
- `--no-simplification-of-shared-nodes`: Don't simplify nodes shared between features (prevents gaps)
- `--no-tile-size-limit`: Don't limit tile size (useful for testing)
- `--no-feature-limit`: Don't limit features per tile (useful for testing)
- `--force`: Overwrite output file if it exists

## Files

| File | Source | Description |
|------|--------|-------------|
| `open-buildings.pmtiles` | Microsoft Open Buildings (Andorra) | ~1000 building polygons |
| `fieldmaps-boundaries.pmtiles` | FieldMaps ADM boundaries | Administrative boundaries |
| `road-detections.pmtiles` | Road detection data | Road linestrings |

## Decoded Tiles

The `decoded/` subdirectory contains MVT tiles extracted from the PMTiles archives
and decoded to GeoJSON using ogr2ogr. These are used for golden comparison tests.

Extraction command:
```bash
pmtiles tile <archive>.pmtiles <z> <x> <y> > tile.mvt
ogr2ogr -f GeoJSON output.geojson tile.mvt
```

Note: Decoded GeoJSON uses tile-local coordinates (0-4096 extent), not geographic coordinates.

## Known Differences from Our Implementation

1. **Density-based dropping**: Tippecanoe uses Hilbert curve ordering and gap-based
   selection. We use a simpler grid-based approach. Both achieve similar feature
   reduction at low zoom levels, but results are not identical. Our density
   dropping is disabled by default; enable with `.with_density_drop(true)`.

2. **Tiny polygon reduction**: Both use diffuse probability for polygons smaller
   than 4 square subpixels. Our implementation may be slightly more aggressive,
   resulting in fewer features than tippecanoe at high zoom levels.

3. **Simplification tolerance**: We use the same Douglas-Peucker algorithm but
   may have slightly different tolerance calculations.

## Current Comparison (Phase 3 Complete)

| Zoom | Tippecanoe | gpq-tiles (default) | gpq-tiles (density drop) |
|------|------------|---------------------|--------------------------|
| Z8 | 97 | 76 | 9-34 (varies by cell_size) |
| Z10 | 484 | 392 | N/A (disabled at high zoom) |

Our tiny polygon dropping is actually more aggressive than tippecanoe's, resulting
in fewer features (76 vs 97 at Z8) even without density dropping enabled.
